import glob
import os

from pandas import read_csv

signatures_path = r".\signature-descriptions.csv"
path_to_json = r".\simplifiedReports\\"


def get_all_features():
    file_read = open("signature-descriptions.csv", "r")
    content = file_read.read()
    features = content.split(";")
    file_read.close()
    return features


def check_if_string_in_file(file_name, string_to_search):
    """ Check if any line in the file contains given string """
    # Open the file in read only mode
    with open(file_name, 'r') as read_obj:
        # Read all lines in the file one by one
        for line in read_obj:
            # For each line, check if line contains the string
            if string_to_search in line:
                return True
    return False


FEATURES = get_all_features()


def get_file_features(jsonFile):
    feature_list = []
    features = FEATURES
    index = 0
    # TEMPcount = 0 #DEBUG
    for feature in features:
        if check_if_string_in_file(jsonFile, feature):
            feature_list.append(1)
            # print(feature + " in " + jsonFile) #DEBUG
            # TEMPcount += 1 #DEBUG
        else:
            feature_list.append(0)
        index += 1
    # print("DEBUG: " + str(TEMPcount)) #DEBUG
    return feature_list


# read all json files and check for features
json_pattern = os.path.join(path_to_json, '*.json')
file_list = glob.glob(json_pattern)
featureMatrix = []  # an empty list to store the data frames
for file in file_list:
    featureMatrix.append(get_file_features(file))

transposedFeatureMatrix = [[featureMatrix[j][i] for j in range(len(featureMatrix))] for i in range(len(featureMatrix[0]))]

