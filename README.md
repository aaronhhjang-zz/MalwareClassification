# Dynamic Malware Analysis and Malware Classification

This project was part of ECSE 458D1 & 458D2 during F2020 & W2021 semesters.
## Abstract
In recent years, major corporations and governments have fallen victim to cyberattacks, and this trend is not going away. One common way to execute such an attack is through the use of malware taking the form of an executable file. In this project, Cuckoo Sandbox, an automated malware analysis environment was used in order to execute and analyze 3694 malware files, which belong to 114 distinct malware families. As Cuckoo Sandbox was generating reports for each file analyzed, we wrote a script which further funneled the report, leaving out only the things we needed: the malware “score”, the descriptions of the malware’s features, and the name of the family which the malware belongs to. This information was later used to train various classifiers which would classify malware into their respective malware families given the score and the descriptions. While it is common knowledge in the machine learning community that more input samples leads to higher accuracy, this is not the case here, because as we had more malware samples, the number of families (classes) also increased, making it harder for the model to predict the malware family, as there are so many. Out of SVM, Random Forest and Decision Tree, the last performed consistently better overall, with a final accuracy rating of 29.91%. To improve this accuracy, more research would have to be done on imbalanced multiclass classification problems, and a larger distinction between malware features would have to be introduced.

## Conclusion
This year-long project was an introduction for us into both the field of cybersecurity, and the field of machine learning. As beginners in these fields, and with a relatively limited timeframe, our work is in no way a complete analysis of the problem which we were meant to solve. The problem of classifying malware into their respective malware families is a very complex one, and more features are needed than simply the “malware score” and the “signature descriptions”, which we used. Using these two features to distinguish between malware creates a large intersection, where most malware have a lot of the same traits and features. Couple that with the fact that Cuckoo Sandbox has its own limitations and downsides, and we can easily see that the results won’t be perfect. Cuckoo sandbox however does provide a lot of breadth in its output, therefore there is a lot which can be used, and the details of this should be explored further.

Apart from having more features, if someone were to want to continue working on this project, we would recommend using more metrics than simply the “score” in sklearn. This could be “precision” and “recall” for example, which would give more info about the false positive and false negative results. This may lead to a better understanding of the model. And regarding the model itself, Neural Networks (NN) and its variants had not been explored, so that may be a useful endeavor to attempt in the future.

  

Overall, we got to apply the fundamentals that we have accumulated over the years in our program. We learned that a design project requires thorough planning and good team communication in order to succeed and to make the experience enjoyable.
### To run:
0. (optional) Delete preexisting *.pkl files.
1. if no model.pkl: go to step 2; if model.pkl exsists: go to step 3.
2. py MalwareClassifier.py to train the model (may take few minutes)
3. py cli_classification.py to play around with the model.


# Files

## Dynamic Analysis
Performed using Cuckoo Sandbox. 
Input: Zipped or executable potential malware files 
Output: Reports generated (see example of extracted data from Cuckoo Sandbox)

**![](https://lh6.googleusercontent.com/ktmrgG_PdxQmr-yQfcG-b8GR02GefLsJz-StbyXq10bsArrcZTmg1rrwuWdzDLzeP0tSu7_cjEp4Gsob9FSkVH1wrqSZ_9k49Oy-wqGSimleMiRN4PqnEyNH4C1hbLvFzaOLx9OI)**

### Data Extraction and Preprocessing
- *./scripts/GenerateSignatures.js:* Get all signature descriptions possible from cuckoo config files. Returns signature_description_all.csv
- *./scripts/SimplifyJsonReports.js:* Extract only the desired data that will serve as inputs to the classifier, from the collection of output generated by Cuckoo. Desired data includes: malware name, malware family name, score, signatures (descriptions + severity).
- *./simplifiedReports/:* Output of *./scripts/SimplifyJsonReports.json*. Used as input to train ML model.
- dataPreprocessing.py: Data manipulation of the ./simplifiedReports/*.json to serve as input to our model.

## Dynamic Analysis
- _MalwareClassifier.py_: ML model training.
- _cli_classification.py_: Simple CLI serving as prototype for a potential usage of the classifier.
- *.pkl: pkl files that aid persisting components of the components of the model or the classifier itself.

