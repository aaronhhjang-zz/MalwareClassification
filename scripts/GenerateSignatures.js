var glob = require("glob"),
  path = require("path");

const nameOfOut = "signature-descriptions";
const outputFormat = ".csv";

// absolute paths
const pathsToSignatures = [
  "/opt/cuckoo/signatures/windows",
  "/opt/cuckoo/signatures/network",
];

let fileCount = 0;
let signatures = [];

for (i = 0; i < 2; i++) {
  glob.sync(pathsToSignatures[i]).forEach(function (file) {
    try {
      const fs = require("fs");
      const data = fs.readFileSync(path.resolve(file), "utf8");

      let beginKeyWord = 'description = "';
      let endKeyWord = "\nseverity";
      let signatrueDescription = data.slice(
        beginKeyWord + beginKeyWord.length,
        endKeyWord
      );
      signatures.push(signatrueDescription);
      fileCount++;

      console.log(
        fileCount + ". Successfully retrieved description from " + file
      );
    } catch (e) {
      console.log("Error at file: " + file);
    }
  });
}

try {
  let csv = signatures.join(",");

  let outputFile = nameOfOut + outputFormat;
  fs.writeFileSync(outputFile, csv);
  console.log(
    "Finished writing " + fileCount + " signatures into " + outputFile
  );
} catch (e) {
  console.log("Error writing to csv");
}
