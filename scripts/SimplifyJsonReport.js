var glob = require("glob"),
  path = require("path");
const { report } = require("process");

const nameOfOut = "simplified";
const outputFormat = ".json";

// EDIT THIS PATH BEFORE USING
const genericPathToReportJson = "../report/**/*.json"; // Relative path locally
// const genericPathToReportJson = "analyses/**/reports/*.json"; // relative path in vm
let fileCount = 0;

glob.sync(genericPathToReportJson).forEach(function (file) {
  const fs = require("fs");
  const data = require(path.resolve(file));

  // HARDCODED: EDIT BEFORE USING w.r.t. genericPathToReportJson
  let fileNum = file.slice(10, 12); // uncomment if running locally
  //let fileNum = file.slice(9, 11); // uncomment if running in vm

  let signatures = [];
  for (i = 0; i < data.signatures.length; i++) {
    signatures.push({
      description: data.signatures[i].description,
      severity: data.signatures[i].severity,
    });
  }

  let temp = { score: data.info.score, signatures: signatures };

  console.log(temp);
  var json = JSON.stringify(temp);

  // Overwrites pre-existing "simplifiedx.json"
  fs.writeFile(nameOfOut + fileNum + outputFormat, json, function (err) {
    if (err) throw err;
  });

  console.log(
    "Finished parsing " + fileCount++ + " " + nameOfOut + fileNum + outputFormat
  );
});
